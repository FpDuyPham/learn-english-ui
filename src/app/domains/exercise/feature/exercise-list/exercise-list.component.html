<div class="p-4 md:p-5 min-h-screen surface-ground">
  <div class="max-w-screen-xl mx-auto">
    <!-- Header Section -->
    <div
      class="flex flex-column md:flex-row justify-content-between align-items-start md:align-items-center gap-3 mb-4 p-3 md:p-4 surface-card border-round-xl shadow-2">
      <div class="flex-1">
        <h1 class="text-3xl md:text-5xl font-bold m-0 mb-2 text-900">Exercises</h1>
        <p class="text-sm md:text-lg text-600 m-0">Manage and practice your English exercises</p>
      </div>

      <div class="flex align-items-center gap-3 w-full md:w-auto">
        <button pButton type="submit" label="Create New Exercise" (click)="createExercise()" icon="pi pi-plus"
          class="white-space-nowrap shadow-3 flex-1 md:flex-none"></button>

        <ng-container *ngIf="profile$ | async as profile">
          <!-- Gamification Compact -->
          <div class="hidden md:block">
            <app-gamification-compact></app-gamification-compact>
          </div>

          <!-- Divider -->
          <div class="border-left-1 surface-border h-2rem hidden md:block"></div>

          <!-- Profile Avatar -->
          <div class="cursor-pointer relative hidden md:block" (click)="op.toggle($event)">
            <p-avatar [label]="profile.name.charAt(0)" shape="circle" size="large"
              [style]="{'background-color': getAvatarColor(profile.name), 'color': '#ffffff'}">
            </p-avatar>
            <p-badge [value]="profile.currentLevel?.toFixed(1) || '1.0'" severity="success"
              styleClass="absolute -bottom-1 -right-1">
            </p-badge>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Profile Overlay Panel -->
    <p-overlayPanel #op styleClass="w-20rem" *ngIf="profile$ | async as profile">
      <div class="flex flex-column gap-3 p-2">
        <div class="flex align-items-center gap-3 mb-2">
          <p-avatar [label]="profile.name.charAt(0)" shape="circle" size="xlarge"
            [style]="{'background-color': getAvatarColor(profile.name), 'color': '#ffffff'}">
          </p-avatar>
          <div>
            <div class="font-bold text-xl">{{ profile.name }}</div>
            <div class="text-600">Level {{ profile.currentLevel }}</div>
          </div>
        </div>

        <div class="surface-100 p-3 border-round">
          <div class="flex justify-content-between mb-2">
            <span class="font-semibold">XP</span>
            <span class="text-primary font-bold">{{ profile.xp }}</span>
          </div>
          <div class="flex justify-content-between mb-2">
            <span class="font-semibold">Streak</span>
            <span class="text-primary font-bold">{{ profile.streak.currentStreak }} days</span>
          </div>
          <div class="flex justify-content-between">
            <span class="font-semibold">Words Learned</span>
            <span class="text-primary font-bold">{{ profile.stats?.totalWordsLearned || 0 }}</span>
          </div>
        </div>

        <!-- Logout Button -->
        <button pButton label="Logout" icon="pi pi-sign-out" (click)="logout()"
          class="p-button-outlined p-button-danger w-full"></button>
      </div>
    </p-overlayPanel>

    <!-- Gamification Widget -->
    <div class="mb-4">
      <app-gamification-widget></app-gamification-widget>
    </div>

    <!-- Exercises List -->
    <div class="surface-card p-2 md:p-4 shadow-2 border-round-xl">
      <p-table [value]="(exercises$ | async) || []" [paginator]="true" [rows]="10" responsiveLayout="stack"
        [breakpoint]="'960px'" styleClass="p-datatable-lg" [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} exercises"
        [tableStyle]="{'min-width': '50rem'}" class="w-full">

        <ng-template pTemplate="header">
          <tr>
            <th style="width: 10%">ID</th>
            <th style="width: 60%">Exercise Name</th>
            <th style="width: 30%" class="text-right">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-exercise>
          <tr>
            <td><span class="p-column-title font-bold">ID</span>{{ exercise.id }}</td>
            <td>
              <span class="p-column-title font-bold">Name</span>
              <div class="font-semibold text-lg text-900">{{ exercise.name }}</div>
              <div class="text-500 text-sm mt-1" *ngIf="exercise.description">{{ exercise.description }}</div>
            </td>
            <td class="text-right">
              <span class="p-column-title font-bold">Actions</span>
              <div class="flex gap-2 justify-content-end flex-wrap">
                <button pButton icon="pi pi-play" label="Passive" class="p-button-outlined p-button-success p-button-sm"
                  (click)="gotoLearnPassive(exercise.id!)"></button>
                <button pButton icon="pi pi-pencil" label="Edit" class="p-button-outlined p-button-info p-button-sm"
                  (click)="editExercise(exercise.id!)"></button>
                <button pButton icon="pi pi-trash" class="p-button-outlined p-button-danger p-button-sm"
                  (click)="deleteExercise(exercise.id!)" pTooltip="Delete"></button>
                <button pButton icon="pi pi-book" label="Learn" class="p-button-primary p-button-sm"
                  (click)="goToListenAndWrite(exercise.id!)"></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center p-5">
              <div class="flex flex-column align-items-center gap-3">
                <div class="border-circle surface-100 flex align-items-center justify-content-center"
                  style="width: 4rem; height: 4rem">
                  <i class="pi pi-inbox text-4xl text-500"></i>
                </div>
                <div class="text-900 font-semibold text-xl">No exercises found</div>
                <div class="text-600">Create your first exercise to get started!</div>
                <button pButton label="Create Exercise" icon="pi pi-plus" (click)="createExercise()"
                  class="mt-2"></button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </div>
</div>
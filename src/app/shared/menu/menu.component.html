<div class="card">
  <p-menubar [model]="items" styleClass="shadow-3 border-round-lg">
    <ng-template pTemplate="start">
      <div class="flex align-items-center gap-2 mr-4">
        <i class="pi pi-book text-primary text-3xl"></i>
        <span class="font-bold text-2xl text-primary hidden md:inline">Learn English</span>
      </div>
    </ng-template>

    <ng-template pTemplate="end">
      <div class="flex align-items-center gap-2" *ngIf="profile$ | async as profile">
        <!--Compact Gamification Widget -->
        <app-gamification-compact></app-gamification-compact>

        <!-- Divider -->
        <div class="border-left-1 surface-border h-2rem"></div>

        <!-- User Avatar with Level Badge -->
        <div class="cursor-pointer relative" (click)="op.toggle($event)">
          <p-avatar [label]="profile.name.charAt(0)" shape="circle" size="large"
            [style]="{'background-color': 'var(--primary-color)', 'color': '#ffffff'}">
          </p-avatar>
          <p-badge [value]="profile.currentLevel?.toFixed(1) || '1.0'" severity="success"
            styleClass="absolute -bottom-1 -right-1">
          </p-badge>
        </div>

        <!-- Profile Overlay -->
        <p-overlayPanel #op styleClass="w-20rem">
          <div class="flex flex-column gap-3 p-2">
            <div class="flex align-items-center gap-3 mb-2">
              <p-avatar [label]="profile.name.charAt(0)" shape="circle" size="xlarge"
                [style]="{'background-color': 'var(--primary-color)', 'color': '#ffffff'}">
              </p-avatar>
              <div>
                <div class="font-bold text-xl">{{ profile.name }}</div>
                <div class="text-600">Level {{ profile.currentLevel }}</div>
              </div>
            </div>

            <div class="surface-100 p-3 border-round">
              <div class="flex justify-content-between mb-2">
                <span class="font-semibold">XP</span>
                <span class="text-primary font-bold">{{ profile.xp }}</span>
              </div>
              <div class="flex justify-content-between mb-2">
                <span class="font-semibold">Garden</span>
                <span class="text-primary font-bold">{{ profile.garden?.theme?.replace('_', ' ') | titlecase }}</span>
              </div>
              <div class="flex justify-content-between">
                <span class="font-semibold">Words Learned</span>
                <span class="text-primary font-bold">{{ profile.stats?.totalWordsLearned || 0 }}</span>
              </div>
            </div>
          </div>
        </p-overlayPanel>

        <!-- Divider -->
        <div class="border-left-1 surface-border h-2rem mx-2"></div>

        <!-- Dark Mode Toggle -->
        <p-button [icon]="isDarkMode ? 'pi pi-moon' : 'pi pi-sun'" (onClick)="toggleDarkMode()" [rounded]="true"
          [text]="true" severity="secondary" pTooltip="Toggle dark mode" tooltipPosition="bottom"></p-button>
      </div>
    </ng-template>
  </p-menubar>
</div>